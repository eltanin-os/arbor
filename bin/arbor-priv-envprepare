#!/bin/execlineb -P
if { ln -s bin sbin }
if { ln -s . usr }
if { mkdir -p etc }
if { touch etc/passwd etc/group }
importas -i ARBOR ARBOR
if {
	if { mkdir -p bin }
	elglob arbin "${ARBOR}/bin/*"
	cp $arbin bin
}
importas -i ARBOR_PACKAGEDIR ARBOR_PACKAGEDIR
if {
	importas -i ARBOR_PACKAGESRC ARBOR_PACKAGESRC
	cd tmp/${ARBOR_PACKAGESRC}
	arbor-priv-patch $ARBOR_PACKAGEDIR
}
importas -i ARBOR_SANDBOX ARBOR_SANDBOX
if {
	if { mkdir -p etc/arbor }
	backtick -Ex repo {
		pipeline {
			pipeline { echo ${ARBOR_PACKAGEDIR} }
			awk "{n=length(\"${ARBOR}\"); print substr($0, n+2)}"
		}
		cut -d"/" -f2
	}
	arbor-priv-createconfigfile
	    etc/arbor/config
	    ${ARBOR}/config/defaults
	    ${ARBOR}/config/${ARBOR_SANDBOX}
	    ${ARBOR}/repo/${repo}/repo.conf
	    ${ARBOR_PACKAGEDIR}/config
}
if { cp ${ARBOR_PACKAGEDIR}/build tmp/build.arbor }
arbor-priv-create$ARBOR_SANDBOX tmp/build
