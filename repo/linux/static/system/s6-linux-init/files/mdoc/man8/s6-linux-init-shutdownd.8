.Dd November 11, 2023
.Dt S6-LINUX-INIT-SHUTDOWND 8
.Os
.Sh NAME
.Nm s6-linux-init-shutdownd
.Nd manage the shutdown procedure for an s6-linux-init installation
.Sh SYNOPSIS
.Nm
.Op Fl d Ar notif
.Op Fl c Ar basedir
.Op Fl g Ar gracetime
.Op Fl C
.Op Fl B
.Sh DESCRIPTION
.Nm
is the daemon that manages the shutdown procedure for an s6-linux-init
installation.
It is not meant to be called directly by the user.
.Pp
.Nm
opens a named pipe in its current directory and listens to it.
This fifo has a fixed, internal, name: this is a rendezvous point
where programs such as
.Xr s6-linux-init-shutdown 8
send their commands when they are told to trigger the shutdown procedure.
.Pp
When it receives a command to shut down,
.Nm
first spawns the
.Pa rc.shutdown
script defined by the
.Xr s6-linux-init-maker 8
invocation that created the
.Ql shutdownd
service.
.Pp
When this script exits,
.Nm
kills all processes, first with a
.Dv SIGTERM ,
then
.Po
after the grace time specified by the shutdown command
.Pc
with a
.Dv SIGKILL .
.Pp
It then runs an automatically-generated script
.Po
called
.Em stage 4
.Pc ,
which unmounts the file systems and halts, powers off or reboots the
machine.
.Pp
The
.Nm
binary is not meant to be called directly by administrators.
It is run by an s6 service that is automatically generated by
.Xr s6-linux-init-maker 8 .
.Sh OPTIONS
.Bl -tag -width x
.It Fl d Ar notif
When ready
.Po
actually listening to its named pipe
.Pc ,
write a newline to file descriptor
.Ar notif
then close it.
This allows
.Nm
to use the
.Xr s6-notifywhenup 7
mechanism to notify readiness.
.Ar notif cannot be lesser than 3.
If this option is not given, no readiness notification is sent.
.It Fl c Ar basedir
Look for the
.Pa rc.shutdown
script in the
.Pa "" Ns Ar basedir Ns /scripts
directory.
Default is
.Pa /etc/s6-linux-init/current .
.It Fl g Ar gracetime
If the shutdown command does not specify a grace time between the
.Dv SIGTERM
and the
.Dv SIGKILL ,
use
.Ar gracetime
milliseconds.
Default is
.Ql 3000 .
.It Fl C
Inform the shutdown daemon that it is running in a container.
This changes the nature of
.Em stage 4 ,
since exiting a container is slightly different from rebooting a real
machine
.Po
in particular, pid 1 has to exit, and great care must be given not to
leave any zombie hanging around
.Pc .
.It Fl B
Inform the shutdown daemon that no catch-all logger is running.
This also changes the shutdown procedure slightly, since some
operations are specific to the existence of a catch-all logger.
.El
.Sh EXIT STATUS
.Bl -tag -width x
.It 0
Success.
.It 100
Permanent error
.Po
such as a misuse
.Pc .
.It 111
Temporary error
.Po
such as a system call failure
.Pc .
.El
.Sh SEE ALSO
.Xr s6-linux-init-echo 1 ,
.Xr s6-linux-init-overview 7 ,
.Xr s6-linux-init-quickstart 7 ,
.Xr s6-linux-init-why 7 ,
.Xr s6-linux-init 8 ,
.Xr s6-linux-init-hpr 8 ,
.Xr s6-linux-init-logouthookd 8 ,
.Xr s6-linux-init-maker 8 ,
.Xr s6-linux-init-nuke 8 ,
.Xr s6-linux-init-shutdown 8 ,
.Xr s6-linux-init-telinit 8 ,
.Xr s6-linux-init-umountall 8
.Pp
This man page is ported from the authoritative documentation at:
.Lk https://skarnet.org/software/s6-linux-init/s6-linux-init-shutdownd.html
.Sh AUTHORS
.An Laurent Bercot
.An Alexis Ao Mt flexibeast@gmail.com Ac (man page port)
